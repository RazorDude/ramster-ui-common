!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs/operators"),require("rxjs"),require("co"),require("@angular/common/http"),require("@angular/core")):"function"==typeof define&&define.amd?define("ramster-ui-core",["exports","@angular/common","rxjs/operators","rxjs","co","@angular/common/http","@angular/core"],t):t(e["ramster-ui-core"]={},e.ng.common,e.rxjs.operators,e.rxjs,e.co,e.ng.common.http,e.ng.core)}(this,function(e,t,r,v,s,p,n){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s;var o=(a.decorators=[{type:n.Directive,args:[{selector:"[component-injector-area]"}]}],a.ctorParameters=function(){return[{type:n.ViewContainerRef}]},a);function a(e){this.viewContainerRef=e}var i=(u.prototype.ngAfterViewInit=function(){var e=this.componentFactoryResolver.resolveComponentFactory(this.component),t=this.componentRef.viewContainerRef;t.clear(),this.componentRefInstance=t.createComponent(e).instance,this.componentRefInstance.data=this.data,this.cdRef.detectChanges()},u.decorators=[{type:n.Component,args:[{selector:"component-injector",template:"<!DOCTYPE html><ng-template component-injector-area></ng-template>"}]}],u.ctorParameters=function(){return[{type:n.ChangeDetectorRef},{type:n.ComponentFactoryResolver}]},u.propDecorators={componentRef:[{type:n.ViewChild,args:[o]}],component:[{type:n.Input}],data:[{type:n.Input}]},u);function u(e,t){this.cdRef=e,this.componentFactoryResolver=t}var c=(l.prototype.ngOnInit=function(){var n=this;this.globalEventsService.pageLoaded$.subscribe(function(e){return n.pageLoaded(e)}),this.globalEventsService.triggerInitialDataLoad$.subscribe(function(){return n.loadInitialData()}),this.globalEventsService.setLayoutData$.subscribe(function(e){return n.setLayoutData(e)}),this.globalEventsService.redirect$.subscribe(function(e){var t=e.route,r=e.options;return n.redirect(t,r)}),this.globalEventsService.toggleLoader$.subscribe(function(e){return n.toggleLoader(e)})},l.prototype.sendInitialDataLoadedEvent=function(){this.globalEventsService.initialDataLoaded({queryParams:this.queryParams,routeParams:this.routeParams})},l.prototype.pageLoaded=function(e){if(e)for(var t in e)this[t]=e[t];this.initialDataLoaded?this.sendInitialDataLoadedEvent():this.loadInitialData()},l.prototype.loadInitialData=function(){this.sendInitialDataLoadedEvent()},l.prototype.setLayoutData=function(e){for(var t in e)this[t]=e[t]},l.prototype.redirect=function(e,t){var r=t||{},n=r.queryParams;r.reloadInitialData&&(this.initialDataLoaded=!1),this.router.navigate([e],{queryParams:n||{}})},l.prototype.toggleLoader=function(e){this.loaderActive=e},l);function l(e,t){this.globalEventsService=e,this.router=t,this.initialDataLoaded=!1,this.loaderActive=!1,this.queryParams={},this.routeParams={}}var f=(h.prototype.ngOnInit=function(){var t=this;this.globalEventsService.initialDataLoaded$.pipe(r.takeUntil(this.destroyed)).subscribe(function(e){return t.initialDataLoaded(e)}),this.globalEventsService.layoutDataChanged$.pipe(r.takeUntil(this.destroyed)).subscribe(function(e){return t.layoutDataChanged(e)}),this.onInitMethodNames.forEach(function(e){"function"==typeof t[e]&&t[e]()})},h.prototype.reset=function(){this.queryParams=this.activatedRoute.snapshot.queryParams,this.routeParams=this.activatedRoute.snapshot.params},h.prototype.sendPageLoadedEvent=function(){this.globalEventsService.pageLoaded({queryParams:this.queryParams,routeParams:this.routeParams})},h.prototype.initialDataLoaded=function(t){var r=this;this.loggedInUser=t.user,this.queryParams=t.queryParams,this.routeParams=t.routeParams,this.onInitialDataLoadedMethodNames.forEach(function(e){"function"==typeof r[e]&&r[e](t)})},h.prototype.layoutDataChanged=function(e){},h.prototype.destructor=function(){this.destroyed.next(),this.destroyed.complete()},h.prototype.ngOnDestroy=function(){this.destructor()},h);function h(e,t,r,n){this.activatedRoute=e,this.globalEventsService=t,this.onInitMethodNames=r,this.onInitialDataLoadedMethodNames=n,this.destroyed=new v.Subject}function d(n,o){var a,i,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function r(e){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,i&&(s=2&e[0]?i["return"]:e[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(n,u)}catch(t){e=[6,t],i=0}finally{a=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var y=(b.prototype.pageLoaded=function(e){this.pageLoadedSource.next(e)},b.prototype.triggerInitialDataLoad=function(){this.triggerInitialDataLoadSource.next()},b.prototype.initialDataLoaded=function(e){this.initialDataLoadedSource.next(e)},b.prototype.setLayoutData=function(e){this.setLayoutDataSource.next(e)},b.prototype.layoutDataChanged=function(e){this.layoutDataChangedSource.next(e)},b.prototype.redirect=function(e,t){this.redirectSource.next({route:e,options:t})},b.prototype.notify=function(e,t){this.notifySource.next({type:e,message:t})},b.prototype.toggleLoader=function(e){this.toggleLoaderSource.next(e)},b.decorators=[{type:n.Injectable}],b);function b(){this.pageLoadedSource=new v.Subject,this.triggerInitialDataLoadSource=new v.Subject,this.initialDataLoadedSource=new v.Subject,this.setLayoutDataSource=new v.Subject,this.layoutDataChangedSource=new v.Subject,this.redirectSource=new v.Subject,this.notifySource=new v.Subject,this.toggleLoaderSource=new v.Subject,this.pageLoaded$=this.pageLoadedSource.asObservable(),this.triggerInitialDataLoad$=this.triggerInitialDataLoadSource.asObservable(),this.initialDataLoaded$=this.initialDataLoadedSource.asObservable(),this.setLayoutData$=this.setLayoutDataSource.asObservable(),this.layoutDataChanged$=this.layoutDataChangedSource.asObservable(),this.redirect$=this.redirectSource.asObservable(),this.notify$=this.notifySource.asObservable(),this.toggleLoader$=this.toggleLoaderSource.asObservable()}var g=(m.prototype.flattenObjectForQuery=function(e,t){var r=this,n=[];if(e instanceof Array){if(!t)throw{error:"The top-most item cannot be an array."};return e.forEach(function(e){null!==e&&(!(e instanceof Date)&&e instanceof Array&&"object"==typeof e?n=n.concat(r.flattenObjectForQuery(e,t+"[]")):n.push({key:t+"[]",value:e}))}),n}for(var o in e){var a=e[o];null!==a&&(a instanceof Date||"object"!=typeof a?n.push({key:t?t+"["+o+"]":o,value:a}):n=n.concat(this.flattenObjectForQuery(a,t?t+"["+o+"]":o)))}return n},m.prototype.run=function(l,f,h){var d=this;return new Promise(function(t,r){try{var n=f,o={},e={},a=null;if(h&&"object"==typeof h){var i=h.resolveWithFullResponse;e=function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]])}return r}(h,["resolveWithFullResponse"]),o={resolveWithFullResponse:i}}if("get"===l.toLowerCase()){e&&"object"==typeof e||(e={});var s=d.flattenObjectForQuery(e.params||{});n+="?_="+(new Date).getTime().toString(),s.length&&s.forEach(function(e,t){n+="&"+e.key+"="+e.value})}else e&&"object"==typeof e||(e={}),(a=e.body&&"object"==typeof e.body?e.body:{})._=(new Date).getTime(),delete e.body;d.client.request(new p.HttpRequest(l,n,a,e)).toPromise().then(function(e){return o.resolveWithFullResponse?t(e):t(e.body)},function(e){return r(e)})}catch(c){r(c)}})},m.decorators=[{type:n.Injectable}],m.ctorParameters=function(){return[{type:p.HttpClient}]},m);function m(e){this.client=e}var S=(E.prototype.emptyToNull=function(e){var r=this;if(""===e)return null;if(e instanceof Date)return e;if(e instanceof Array)return e.map(function(e,t){return r.emptyToNull(e)});if("object"!=typeof e||null===e)return e;var t={};for(var n in e)t[n]=this.emptyToNull(e[n]);return t},E.prototype.stringifyGetParams=function(e){var t={};for(var r in e){var n=e[r];n instanceof Array||!("object"!=typeof n||null===n||n instanceof Date)?t["_json_"+r]=JSON.stringify(n):t[r]=n}return t},E.prototype.handleError=function(e,t){var r=(t||{}).notifyOnError;e?this.redirectOnForbiddenUrl&&(401===e.status||e.error&&401===e.error.status)?this.globalEventsService.redirect(this.redirectOnForbiddenUrl):413===e.status||e.error&&413===e.error.status?this.globalEventsService.notify("error",this.fileTooLargeErrorMessage):!1!==r&&this.globalEventsService.notify("error",e.error&&e.error.error||"An error has occurred."):!1!==r&&this.globalEventsService.notify("error","An unknown error has occurred.")},E.prototype.create=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("post",""+o.baseUrl,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype.read=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/item",{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype.readList=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",""+o.baseUrl,{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype.streamReadList=function(e,t,r){var n=r||{},o=n.onError,a=n.reconnectAttemptInterval,i=o||this.handleError.bind(this),s=n.reconnectAttemptsLeft,u=""+window.location.origin+this.baseUrl+"/streamList",c=this.stringifyGetParams(this.emptyToNull(e)),l=!0;for(var f in c)l?(l=!1,u+="?"):u+="&",u+=f+"="+c[f];var h=new EventSource(u),d=new v.Subject,p={value:!0};h.onmessage=function(e){return t(e)},h.onerror=function(e){return i(e)};var y=setInterval(function(){if(2===h.readyState&&p.value&&(void 0===s||0<s))return(h=new EventSource(u)).onmessage=function(e){return t(e)},h.onerror=function(e){return i(e)},void(void 0!==s&&s--);clearInterval(y)},a||5e3);return d.subscribe(function(){p.value=!1,h.close()}),d},E.prototype.readSelectList=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/selectList",{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype.update=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("patch",o.baseUrl+"/item/"+n.id,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype.bulkUpsert=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("put",""+o.baseUrl,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.prototype["delete"]=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("delete",o.baseUrl+"/"+n.id,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},E.decorators=[{type:n.Injectable}],E.ctorParameters=function(){return[{type:y},{type:g}]},E);function E(e,t){this.globalEventsService=e,this.requestService=t,this.baseUrl="/",this.fileTooLargeErrorMessage="The selected file is too large.",this.headers=new p.HttpHeaders({"Content-Type":"application/json"}),this.redirectOnForbiddenUrl=null}var w=(L.prototype.handleError=function(e){e?413===e.status||e.error&&413===e.error.status?this.globalEventsService.notify("error","The selected file is too large."):this.globalEventsService.notify("error",e.error&&e.error.error||"An error has occurred."):this.globalEventsService.notify("error","An unknown error has occurred.")},L.prototype.upload=function(n,o,a){var i=this;return new Promise(function(t,r){s(function(){var t,r;return d(this,function(e){switch(e.label){case 0:for(r in(t=new FormData).append("file",n,n.name),o)t.append(r,o[r]);return i.headers.set("Content-Type","multipart/form-data"),[4,i.requestService.run("post",""+i.baseUrl,{headers:i.headers,body:t})];case 1:return e.sent(),[2,{success:!0}]}})}).then(function(e){return t(e)},function(e){a&&a.handleError&&i.handleError(e),r({error:e||!0})})})},L.prototype.read=function(n){var o=this;return new Promise(function(t,r){s(function(){return d(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/item",{headers:o.headers,params:n})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},L.decorators=[{type:n.Injectable}],L.ctorParameters=function(){return[{type:y},{type:g}]},L);function L(e,t){this.globalEventsService=e,this.requestService=t,this.headers=new p.HttpHeaders,this.baseUrl="/files"}var D=(P.prototype.get=function(e){return this.modelRESTServices[e+"ModelRESTService"]},P.prototype.setServices=function(t){var r=this;this.modelRESTServices={},Object.keys(t).forEach(function(e){r.modelRESTServices[""+e.charAt(0).toLowerCase()+e.substr(1,e.length)]=r.injector.get(t[e])})},P.decorators=[{type:n.Injectable}],P.ctorParameters=function(){return[{type:n.Injector}]},P);function P(e){this.injector=e,this.modelRESTServices={}}var j=function(e,t,r){if("object"!=typeof e||null===e||"string"!=typeof t||!t.length)return undefined;for(var u,c=(r||{}).arrayItemsShouldBeUnique,l=t.split("."),f=l.length,h=e,n=function(e){if(null==h)return{value:undefined};var t=l[e];if("$"===t.charAt(0)){for(var r=!1,n=e+1;n<f;){var o=l[n];if("$"===o.charAt(0))break;if("$"===o.charAt(o.length-1)){r=!0;break}n++}if(r){for(var a=e+1;a<=n;a++)t+="."+l[a];e=n}}var i=h[t];if(void 0===i)return{value:undefined};if(i instanceof Array){if(e===f-1)return{value:i};if(isNaN(parseInt(l[e+1],10))){h=[];var s="";for(a=e+1;a<f;a++)s+=l[a]+(a<f-1?".":"");return i.forEach(function(e){var t=j(e,s);if(void 0!==t){if(t instanceof Array)return void t.forEach(function(e){(!c||c&&-1===h.indexOf(e))&&h.push(e)});(!c||c&&-1===h.indexOf(t))&&h.push(t)}}),{value:h}}}h=i,u=e},o=0;o<f;o++){var a=n(o);if(o=u,"object"==typeof a)return a.value}return h},I=(O.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule],declarations:[i,o],exports:[i]}]}],O);function O(){}e.RamsterUICoreModule=I,e.BaseLayoutComponent=c,e.BasePageComponent=f,e.BaseRESTService=S,e.FilesRESTService=w,e.GlobalEventsService=y,e.ModelRESTServiceProviderService=D,e.RequestService=g,e.getNested=j,e.setNested=function(e,t,r){var n=t.split(".");if(!n.length)return!1;for(var o=e,a=n.length-1,i=0;i<a;i++){var s=n[i];if("undefined"==typeof o[s])return!1;o=o[s]}return o[n[a]]=r,!0},e.ɵa=i,e.ɵb=o,Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ramster-ui-core.umd.min.js.map