!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@angular/common"),require("rxjs/operators"),require("rxjs"),require("co"),require("@angular/common/http"),require("@angular/core")):"function"==typeof define&&define.amd?define("ramster-ui-core",["exports","@angular/common","rxjs/operators","rxjs","co","@angular/common/http","@angular/core"],t):t(e["ramster-ui-core"]={},e.ng.common,e.rxjs.operators,e.rxjs,e.co,e.ng.common.http,e.ng.core)}(this,function(e,t,r,o,s,p,n){"use strict";s=s&&s.hasOwnProperty("default")?s["default"]:s;var a=(i.prototype.ngOnInit=function(){var n=this;this.globalEventsService.pageLoaded$.subscribe(function(e){return n.pageLoaded(e)}),this.globalEventsService.triggerInitialDataLoad$.subscribe(function(){return n.loadInitialData()}),this.globalEventsService.setLayoutData$.subscribe(function(e){return n.setLayoutData(e)}),this.globalEventsService.redirect$.subscribe(function(e){var t=e.route,r=e.options;return n.redirect(t,r)}),this.globalEventsService.toggleLoader$.subscribe(function(e){return n.toggleLoader(e)})},i.prototype.sendInitialDataLoadedEvent=function(){this.globalEventsService.initialDataLoaded({queryParams:this.queryParams,routeParams:this.routeParams})},i.prototype.pageLoaded=function(e){if(e)for(var t in e)this[t]=e[t];this.initialDataLoaded?this.sendInitialDataLoadedEvent():this.loadInitialData()},i.prototype.loadInitialData=function(){this.sendInitialDataLoadedEvent()},i.prototype.setLayoutData=function(e){for(var t in e)this[t]=e[t]},i.prototype.redirect=function(e,t){var r=t||{},n=r.queryParams;r.reloadInitialData&&(this.initialDataLoaded=!1),this.router.navigate([e],{queryParams:n||{}})},i.prototype.toggleLoader=function(e){this.loaderActive=e},i);function i(e,t){this.globalEventsService=e,this.router=t,this.initialDataLoaded=!1,this.loaderActive=!1,this.queryParams={},this.routeParams={}}var u=(c.prototype.ngOnInit=function(){var t=this;this.globalEventsService.initialDataLoaded$.pipe(r.takeUntil(this.destroyed)).subscribe(function(e){return t.initialDataLoaded(e)}),this.onInitMethodNames.forEach(function(e){"function"==typeof t[e]&&t[e]()})},c.prototype.reset=function(){this.queryParams=this.activatedRoute.snapshot.queryParams,this.routeParams=this.activatedRoute.snapshot.params},c.prototype.sendPageLoadedEvent=function(){this.globalEventsService.pageLoaded({queryParams:this.queryParams,routeParams:this.routeParams})},c.prototype.initialDataLoaded=function(t){var r=this;this.loggedInUser=t.user,this.queryParams=t.queryParams,this.routeParams=t.routeParams,this.onInitialDataLoadedMethodNames.forEach(function(e){"function"==typeof r[e]&&r[e](t)})},c.prototype.destructor=function(){this.destroyed.next(),this.destroyed.complete()},c.prototype.ngOnDestroy=function(){this.destructor()},c);function c(e,t,r,n){this.activatedRoute=e,this.globalEventsService=t,this.onInitMethodNames=r,this.onInitialDataLoadedMethodNames=n,this.destroyed=new o.Subject}var y=function(){return(y=Object.assign||function(e){for(var t,r=1,n=arguments.length;r<n;r++)for(var o in t=arguments[r])Object.prototype.hasOwnProperty.call(t,o)&&(e[o]=t[o]);return e}).apply(this,arguments)};function l(n,o){var a,i,s,e,u={label:0,sent:function(){if(1&s[0])throw s[1];return s[1]},trys:[],ops:[]};return e={next:t(0),"throw":t(1),"return":t(2)},"function"==typeof Symbol&&(e[Symbol.iterator]=function(){return this}),e;function t(t){return function(e){return function r(e){if(a)throw new TypeError("Generator is already executing.");for(;u;)try{if(a=1,i&&(s=2&e[0]?i["return"]:e[0]?i["throw"]||((s=i["return"])&&s.call(i),0):i.next)&&!(s=s.call(i,e[1])).done)return s;switch(i=0,s&&(e=[2&e[0],s.value]),e[0]){case 0:case 1:s=e;break;case 4:return u.label++,{value:e[1],done:!1};case 5:u.label++,i=e[1],e=[0];continue;case 7:e=u.ops.pop(),u.trys.pop();continue;default:if(!(s=0<(s=u.trys).length&&s[s.length-1])&&(6===e[0]||2===e[0])){u=0;continue}if(3===e[0]&&(!s||e[1]>s[0]&&e[1]<s[3])){u.label=e[1];break}if(6===e[0]&&u.label<s[1]){u.label=s[1],s=e;break}if(s&&u.label<s[2]){u.label=s[2],u.ops.push(e);break}s[2]&&u.ops.pop(),u.trys.pop();continue}e=o.call(n,u)}catch(t){e=[6,t],i=0}finally{a=s=0}if(5&e[0])throw e[1];return{value:e[0]?e[1]:void 0,done:!0}}([t,e])}}}var f=(h.prototype.pageLoaded=function(e){this.pageLoadedSource.next(e)},h.prototype.triggerInitialDataLoad=function(){this.triggerInitialDataLoadSource.next()},h.prototype.initialDataLoaded=function(e){this.initialDataLoadedSource.next(e)},h.prototype.setLayoutData=function(e){this.setLayoutDataSource.next(e)},h.prototype.redirect=function(e,t){this.redirectSource.next({route:e,options:t})},h.prototype.notify=function(e,t){this.notifySource.next({type:e,message:t})},h.prototype.toggleLoader=function(e){this.toggleLoaderSource.next(e)},h.decorators=[{type:n.Injectable}],h);function h(){this.pageLoadedSource=new o.Subject,this.triggerInitialDataLoadSource=new o.Subject,this.initialDataLoadedSource=new o.Subject,this.setLayoutDataSource=new o.Subject,this.redirectSource=new o.Subject,this.notifySource=new o.Subject,this.toggleLoaderSource=new o.Subject,this.pageLoaded$=this.pageLoadedSource.asObservable(),this.triggerInitialDataLoad$=this.triggerInitialDataLoadSource.asObservable(),this.initialDataLoaded$=this.initialDataLoadedSource.asObservable(),this.setLayoutData$=this.setLayoutDataSource.asObservable(),this.redirect$=this.redirectSource.asObservable(),this.notify$=this.notifySource.asObservable(),this.toggleLoader$=this.toggleLoaderSource.asObservable()}var d=(v.prototype.flattenObjectForQuery=function(e,t){var r=this,n=[];if(e instanceof Array){if(!t)throw{error:"The top-most item cannot be an array."};return e.forEach(function(e){null!==e&&(!(e instanceof Date)&&e instanceof Array&&"object"==typeof e?n=n.concat(r.flattenObjectForQuery(e,t+"[]")):n.push({key:t+"[]",value:e}))}),n}for(var o in e){var a=e[o];null!==a&&(a instanceof Date||"object"!=typeof a?n.push({key:t?t+"["+o+"]":o,value:a}):n=n.concat(this.flattenObjectForQuery(a,t?t+"["+o+"]":o)))}return n},v.prototype.run=function(l,f,h){var d=this;return new Promise(function(t,r){try{var n=f,o={},e={},a=null;if(h&&"object"==typeof h){var i=h.resolveWithFullResponse;e=function u(e,t){var r={};for(var n in e)Object.prototype.hasOwnProperty.call(e,n)&&t.indexOf(n)<0&&(r[n]=e[n]);if(null!=e&&"function"==typeof Object.getOwnPropertySymbols){var o=0;for(n=Object.getOwnPropertySymbols(e);o<n.length;o++)t.indexOf(n[o])<0&&(r[n[o]]=e[n[o]])}return r}(h,["resolveWithFullResponse"]),o={resolveWithFullResponse:i}}if("get"===l.toLowerCase()){e&&"object"==typeof e||(e={});var s=d.flattenObjectForQuery(e.params||{});n+="?_="+(new Date).getTime().toString(),s.length&&s.forEach(function(e,t){n+="&"+e.key+"="+e.value})}else e&&"object"==typeof e||(e={}),(a=e.body&&"object"==typeof e.body?e.body:{})._=(new Date).getTime(),delete e.body;d.client.request(new p.HttpRequest(l,n,a,e)).toPromise().then(function(e){return o.resolveWithFullResponse?t(e):t(e.body)},function(e){return r(e)})}catch(c){r(c)}})},v.decorators=[{type:n.Injectable}],v.ctorParameters=function(){return[{type:p.HttpClient}]},v);function v(e){this.client=e}var b=(m.prototype.emptyToNull=function(e){var r=this;if(""===e)return null;if(e instanceof Date)return e;if(e instanceof Array)return e.map(function(e,t){return r.emptyToNull(e)});if("object"!=typeof e||null===e)return e;var t={};for(var n in e)t[n]=this.emptyToNull(e[n]);return t},m.prototype.stringifyGetParams=function(e){var t={};for(var r in e){var n=e[r];n instanceof Array||!("object"!=typeof n||null===n||n instanceof Date)?t["_json_"+r]=JSON.stringify(n):t[r]=n}return t},m.prototype.handleError=function(e,t){var r=(t||{}).notifyOnError;e?this.redirectOnForbiddenUrl&&401===e.status?this.globalEventsService.redirect(this.redirectOnForbiddenUrl):!1!==r&&this.globalEventsService.notify("error",e.error&&e.error.error||"An error has occurred."):!1!==r&&this.globalEventsService.notify("error","An error has occurred.")},m.prototype.create=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("post",""+o.baseUrl,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype.read=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/item",{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype.readList=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",""+o.baseUrl,{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype.readStreamList=function(t,r,n){var o=this,e=n||{},a=e.onError,i=e.reconnectAttemptInterval,s=e.reconnectAttemptsLeft,u=a||this.handleError.bind(this),c=window.location.origin+"/"+this.baseUrl+"/streamList",l=this.stringifyGetParams(this.emptyToNull(t)),f=!0;for(var h in l)f?(f=!1,c+="?"):c+="&",c+=h+"="+l[h];var d=new EventSource(c);return d.onmessage=function(e){return r(e)},d.onerror=function(e){u(e),(void 0===s||0<s)&&(d.close(),setTimeout(function(){o.readStreamList(t,r,y({},n,{reconnectAttemptsLeft:"number"==typeof s?s-1:undefined}))},i||5e3))},d},m.prototype.readSelectList=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/selectList",{headers:o.headers,params:o.stringifyGetParams(o.emptyToNull(n))})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype.update=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("patch",o.baseUrl+"/item/"+n.id,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype.bulkUpsert=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("put",""+o.baseUrl,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.prototype["delete"]=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("delete",o.baseUrl+"/"+n.id,{headers:o.headers,body:o.emptyToNull(n)})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},m.decorators=[{type:n.Injectable}],m.ctorParameters=function(){return[{type:f},{type:d}]},m);function m(e,t){this.globalEventsService=e,this.requestService=t,this.baseUrl="/",this.headers=new p.HttpHeaders({"Content-Type":"application/json"}),this.redirectOnForbiddenUrl=null}var g=(S.prototype.handleError=function(e){this.globalEventsService.notify("error",e&&e.error&&e.error.error||"An error has occurred.")},S.prototype.upload=function(n,o,a){var i=this;return new Promise(function(t,r){s(function(){var t,r;return l(this,function(e){switch(e.label){case 0:for(r in(t=new FormData).append("file",n,n.name),o)t.append(r,o[r]);return i.headers.set("Content-Type","multipart/form-data"),[4,i.requestService.run("post",""+i.baseUrl,{headers:i.headers,body:t})];case 1:return e.sent(),[2,{success:!0}]}})}).then(function(e){return t(e)},function(e){a&&a.handleError&&i.handleError(e),r({error:e||!0})})})},S.prototype.read=function(n){var o=this;return new Promise(function(t,r){s(function(){return l(this,function(e){switch(e.label){case 0:return[4,o.requestService.run("get",o.baseUrl+"/item",{headers:o.headers,params:n})];case 1:return[2,e.sent()]}})}).then(function(e){return t(e)},function(e){o.handleError(e),r({error:!0})})})},S.decorators=[{type:n.Injectable}],S.ctorParameters=function(){return[{type:f},{type:d}]},S);function S(e,t){this.globalEventsService=e,this.requestService=t,this.headers=new p.HttpHeaders,this.baseUrl="/files"}var L=(E.prototype.get=function(e){return this.modelRESTServices[e+"ModelRESTService"]},E.prototype.setServices=function(t){var r=this;this.modelRESTServices={},Object.keys(t).forEach(function(e){r.modelRESTServices[""+e.charAt(0).toLowerCase()+e.substr(1,e.length)]=r.injector.get(t[e])})},E.decorators=[{type:n.Injectable}],E.ctorParameters=function(){return[{type:n.Injector}]},E);function E(e){this.injector=e,this.modelRESTServices={}}var w=function(e,t){if("object"!=typeof e||null===e||"string"!=typeof t||!t.length)return undefined;for(var u,c=t.split("."),l=c.length,f=e,r=function(e){if(null==f)return{value:undefined};var t=c[e];if("$"===t.charAt(0)){for(var r=!1,n=e+1;n<l;){var o=c[n];if("$"===o.charAt(0))break;if("$"===o.charAt(o.length-1)){r=!0;break}n++}if(r){for(var a=e+1;a<=n;a++)t+="."+c[a];e=n}}var i=f[t];if(void 0===i)return{value:undefined};if(i instanceof Array){if(e===l-1)return{value:i};if(isNaN(parseInt(c[e+1],10))){f=[];var s="";for(a=e+1;a<l;a++)s+=c[a]+(a<l-1?".":"");return i.forEach(function(e,t){var r=w(e,s);if(void 0!==r){if(r instanceof Array)return void(f=f.concat(r));f.push(r)}}),{value:f}}}f=i,u=e},n=0;n<l;n++){var o=r(n);if(n=u,"object"==typeof o)return o.value}return f},P=(j.decorators=[{type:n.NgModule,args:[{imports:[t.CommonModule]}]}],j);function j(){}e.RamsterUICoreModule=P,e.BaseLayoutComponent=a,e.BasePageComponent=u,e.BaseRESTService=b,e.FilesRESTService=g,e.GlobalEventsService=f,e.ModelRESTServiceProviderService=L,e.RequestService=d,e.getNested=w,e.setNested=function(e,t,r){var n=t.split(".");if(!n.length)return!1;for(var o=e,a=n.length-1,i=0;i<a;i++){var s=n[i];if("undefined"==typeof o[s])return!1;o=o[s]}return o[n[a]]=r,!0},Object.defineProperty(e,"__esModule",{value:!0})});
//# sourceMappingURL=ramster-ui-core.umd.min.js.map